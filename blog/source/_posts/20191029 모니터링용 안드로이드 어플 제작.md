---
title: 모니터링용 안드로이드 어플 제작
date: 2019-10-29 14:58:52
tags:
---

LoRa 단말기로부터 저장된 데이터를 확인할 수 있다.
데이터베이스 서버에 저장된 로그를 읽어온 후 시각적으로 표시한다.

SDK 17 이상 지원 기기에서 작동하며, Android Studio 3.4.2에서 개발되었다.
오픈소스 라이브러리는 jsoup, MPAndroidChart를 활용했다.

## EUI 목록 갱신에 사용되는 함수
```java
void RefreshEUI() {
        try {
            Thread thread = new Thread(new Runnable() {
                @Override
                public void run() {
                    Document doc;
                    try {
                        doc = Jsoup.connect("http://*******.co.kr:****/***/*******/*****")
                                .requestBody("{\"username\":\"*****\",\"password\":\"***********\"}")
                                .ignoreContentType(true)
                                .post();
                        jwt = new JSONObject(doc.text()).getString("jwt");
                        doc = Jsoup.connect("http://*******.co.kr:****/***/*******?limit=100")
                                .header("Grpc-Metadata-Authorization", "Bearer " + jwt)
                                .ignoreContentType(true)
                                .get();
                        JSONArray result = new JSONObject(doc.text()).getJSONArray("result");
                        for (int i = 0; i < result.length(); i++) {
                            String devEUI = result.getJSONObject(i).getString("devEUI");
                            Log.d(TAG, "devEUI: " + devEUI);
                            euiList.add(devEUI);
                        }
                    } catch (Exception e) {
                        e.printStackTrace();
                       // 오류 팝업 발생
                    }
                }
            });
            thread.start();
            thread.join();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
```
## DB 쿼리 소스
```java
Jsoup.connect("http://*******.co.kr:****/query?u=" + getString(R.string.Username) + "&p=" + getString(R.string.Password) + "&db=******&q=select%20****%2c*******%2c*****%20from%20*****************%20where%20*******%3d%27" + euiList.get(i) + "%27%20order%20by%20time%20desc%20limit%2010").ignoreContentType(true).get();
```

## 구글맵스 쿼리 소스
```java
SupportMapFragment mapFragment = (SupportMapFragment) getSupportFragmentManager()
                .findFragmentById(R.id.map);
        mapFragment.getMapAsync(this);
```

## 어플 실행 화면
{% asset_img e419dfa97ebb3efc.png %}